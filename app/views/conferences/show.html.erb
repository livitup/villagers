<div class="container mt-5">
  <div class="row">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h2 class="h4 mb-0"><%= @conference.name %></h2>
          <% if policy(@conference).update? %>
            <%= link_to "Edit", edit_conference_path(@conference), class: "btn btn-light btn-sm" %>
          <% end %>
        </div>
        <div class="card-body">
          <dl class="row">
            <dt class="col-sm-3">Location:</dt>
            <dd class="col-sm-9"><%= @conference.location || "Not specified" %></dd>

            <dt class="col-sm-3">Start Date:</dt>
            <dd class="col-sm-9"><%= @conference.start_date.strftime("%B %d, %Y") %></dd>

            <dt class="col-sm-3">End Date:</dt>
            <dd class="col-sm-9"><%= @conference.end_date.strftime("%B %d, %Y") %></dd>

            <% if @conference.conference_hours_start && @conference.conference_hours_end %>
              <dt class="col-sm-3">Conference Hours:</dt>
              <dd class="col-sm-9">
                <%= @conference.conference_hours_start.strftime("%l:%M %p") %> - 
                <%= @conference.conference_hours_end.strftime("%l:%M %p") %>
              </dd>
            <% end %>

            <% lead = @conference.conference_roles.find_by(role_name: ConferenceRole::CONFERENCE_LEAD)&.user %>
            <% if lead %>
              <dt class="col-sm-3">Conference Lead:</dt>
              <dd class="col-sm-9"><%= lead.email %></dd>
            <% end %>
          </dl>

          <hr>

          <h5>Conference Team</h5>
          <div class="mb-3">
            <strong>Conference Leads:</strong>
            <ul class="list-group mt-2">
              <% @conference.conference_roles.where(role_name: ConferenceRole::CONFERENCE_LEAD).includes(:user).each do |role| %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <%= role.user.email %>
                  <% if policy(@conference).update? && (@conference.conference_roles.where(role_name: ConferenceRole::CONFERENCE_LEAD).count > 1 || current_user.village_admin?) %>
                    <%= link_to "Remove", conference_conference_role_path(@conference, role), data: { turbo_method: :delete, confirm: "Are you sure?" }, class: "btn btn-sm btn-outline-danger" %>
                  <% end %>
                </li>
              <% end %>
              <% if @conference.conference_roles.where(role_name: ConferenceRole::CONFERENCE_LEAD).empty? %>
                <li class="list-group-item text-muted">No conference lead assigned</li>
              <% end %>
            </ul>
          </div>

          <div class="mb-3">
            <strong>Conference Admins:</strong>
            <ul class="list-group mt-2">
              <% @conference.conference_roles.where(role_name: ConferenceRole::CONFERENCE_ADMIN).includes(:user).each do |role| %>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <%= role.user.email %>
                  <% if policy(@conference).update? %>
                    <%= link_to "Remove", conference_conference_role_path(@conference, role), data: { turbo_method: :delete, confirm: "Are you sure?" }, class: "btn btn-sm btn-outline-danger" %>
                  <% end %>
                </li>
              <% end %>
              <% if @conference.conference_roles.where(role_name: ConferenceRole::CONFERENCE_ADMIN).empty? %>
                <li class="list-group-item text-muted">No conference admins assigned</li>
              <% end %>
            </ul>
          </div>

          <% if policy(@conference).update? %>
            <div class="card mt-3">
              <div class="card-body">
                <h6 class="card-title">Delegate Conference Admin</h6>
                <%= form_with url: conference_conference_roles_path(@conference), method: :post, local: true, class: "row g-3" do |form| %>
                  <div class="col-md-8">
                    <%= select_tag :user_id, options_from_collection_for_select(User.all.order(:email), :id, :email), { include_blank: "Select a user", class: "form-select", required: true } %>
                  </div>
                  <div class="col-md-4">
                    <%= hidden_field_tag :role_name, ConferenceRole::CONFERENCE_ADMIN %>
                    <%= form.submit "Add Admin", class: "btn btn-primary w-100" %>
                  </div>
                <% end %>
                <% if current_user.village_admin? %>
                  <hr>
                  <h6 class="card-title">Assign Conference Lead</h6>
                  <%= form_with url: conference_conference_roles_path(@conference), method: :post, local: true, class: "row g-3" do |form| %>
                    <div class="col-md-8">
                      <%= select_tag :user_id, options_from_collection_for_select(User.all.order(:email), :id, :email), { include_blank: "Select a user", class: "form-select", required: true } %>
                    </div>
                    <div class="col-md-4">
                      <%= hidden_field_tag :role_name, ConferenceRole::CONFERENCE_LEAD %>
                      <%= form.submit "Add Lead", class: "btn btn-primary w-100" %>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        <div class="card-footer d-flex justify-content-between">
          <%= link_to "â† Back to Conferences", conferences_path, class: "btn btn-link" %>
          <div>
            <%= link_to "View Calendar", conference_calendar_path(@conference), class: "btn btn-info me-2" %>
            <% if policy(@conference).update? %>
              <%= link_to "Manage Programs", conference_conference_programs_path(@conference), class: "btn btn-primary" %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
