<div class="container mt-5">
  <div class="row">
    <div class="col-md-8">
      <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
          <h2 class="h4 mb-0"><%= @program.name %></h2>
          <% if policy(@program).update? %>
            <%= link_to "Edit", edit_program_path(@program), class: "btn btn-light btn-sm" %>
          <% end %>
        </div>
        <div class="card-body">
          <% if @program.description.present? %>
            <div class="mb-3">
              <h5>Description</h5>
              <p><%= simple_format(@program.description) %></p>
            </div>
          <% end %>

          <h5>Conferences</h5>
          <% if @program.enabled_conferences.any? %>
            <div class="mb-3">
              <% @program.enabled_conferences.each do |conference| %>
                <%= link_to conference.name, conference, class: "badge bg-primary text-decoration-none me-1" %>
              <% end %>
            </div>
          <% else %>
            <p class="text-muted">Not enabled at any conferences yet.</p>
          <% end %>

          <hr>

          <div class="card bg-light">
            <div class="card-body">
              <h5 class="card-title">Required Qualifications</h5>
              <% if @program.qualifications.any? %>
                <ul class="list-group list-group-flush mb-3">
                  <% @program.qualifications.each do |qualification| %>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <%= qualification.name %>
                      <% if policy(@program).update? %>
                        <%= link_to "Remove", program_program_qualification_path(@program, @program.program_qualifications.find_by(qualification: qualification)),
                            data: { turbo_method: :delete, turbo_confirm: "Remove this qualification requirement?" },
                            class: "btn btn-sm btn-outline-danger" %>
                      <% end %>
                    </li>
                  <% end %>
                </ul>
              <% else %>
                <p class="text-muted">No qualifications required for this program.</p>
              <% end %>

              <% if policy(@program).update? %>
                <% available_qualifications = @qualifications - @program.qualifications %>
                <% if available_qualifications.any? %>
                  <%= form_with url: program_program_qualifications_path(@program), method: :post, local: true, class: "d-flex gap-2" do |f| %>
                    <select name="qualification_id" class="form-select form-select-sm" required>
                      <option value="">Select qualification...</option>
                      <% available_qualifications.each do |qual| %>
                        <option value="<%= qual.id %>"><%= qual.name %></option>
                      <% end %>
                    </select>
                    <%= f.submit "Add", class: "btn btn-sm btn-primary" %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <%= link_to "â† Back to Programs", programs_path, class: "btn btn-link" %>
          <% if policy(@program).destroy? %>
            <%= link_to "Delete", program_path(@program), method: :delete,
                data: { confirm: "Are you sure you want to delete this program?" },
                class: "btn btn-danger btn-sm float-end" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
